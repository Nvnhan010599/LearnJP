<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học Động Từ Tiếng Nhật & Thể て</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #f3f4f6;
        }
        .main-nav-btn.active {
            background-color: #3b82f6;
            color: white;
        }
        .sub-nav-link.active {
            background-color: #dbeafe;
            color: #1d4ed8;
            font-weight: bold;
        }
        .verb-grid-item {
            transition: all 0.2s ease-in-out;
        }
        .verb-grid-item.selected {
            transform: scale(1.05);
            background-color: #60a5fa;
            color: white;
            border-color: #2563eb;
        }
        .feedback-correct {
            background-color: #dcfce7;
            border-left-color: #22c55e;
        }
        .feedback-incorrect {
            background-color: #fee2e2;
            border-left-color: #ef4444;
        }
        .dropdown-menu {
            visibility: hidden;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.2s ease-in-out;
        }
        .group:hover .dropdown-menu {
            visibility: visible;
            opacity: 1;
            transform: translateY(0);
        }
        /* Accordion Styles */
        .accordion-header .accordion-icon {
            transition: transform 0.3s ease-in-out;
        }
        .accordion-header.open .accordion-icon {
            transform: rotate(180deg);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
            background-color: white;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-6 max-w-5xl">
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-5xl font-bold text-blue-600">Luyện Siêu Trí Nhớ Động Từ</h1>
            <p class="text-gray-500 mt-2 text-lg">Học tiếng Nhật hiệu quả và trực quan</p>
        </header>

        <!-- New Hierarchical Navigation -->
        <nav class="flex justify-center items-center space-x-2 md:space-x-4 mb-8 bg-white p-2 rounded-xl shadow-md sticky top-2 z-20">
            <!-- Home Button -->
            <a href="../supplementary.html" class="p-2 rounded-md hover:bg-gray-200 transition" aria-label="Trang chủ">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
            </a>
            <!-- Lý Thuyết Dropdown -->
            <div class="relative group">
                <button id="main-nav-theory" class="main-nav-btn flex items-center space-x-2 w-full text-left px-4 py-2 text-lg font-semibold rounded-md hover:bg-blue-100 transition"><span>Lý thuyết</span></button>
                <div class="dropdown-menu absolute z-10 bg-white shadow-lg rounded-md mt-1 w-48 py-1">
                    <a href="#" id="sub-nav-theory-groups" onclick="showTab('theory-groups', this, event)" class="sub-nav-link block px-4 py-2 text-gray-700 hover:bg-gray-100">Chia Nhóm</a>
                    <a href="#" onclick="showTab('theory-te', this, event)" class="sub-nav-link block px-4 py-2 text-gray-700 hover:bg-gray-100">Chia Thể て</a>
                </div>
            </div>
            <!-- Trò chơi Dropdown -->
            <div class="relative group">
                <button id="main-nav-game" class="main-nav-btn flex items-center space-x-2 w-full text-left px-4 py-2 text-lg font-semibold rounded-md hover:bg-blue-100 transition"><span>Trò chơi</span></button>
                <div class="dropdown-menu absolute z-10 bg-white shadow-lg rounded-md mt-1 w-48 py-1">
                    <a href="#" onclick="showTab('game-irregular', this, event)" class="sub-nav-link block px-4 py-2 text-gray-700 hover:bg-gray-100">Tìm Nhóm 2 ĐB</a>
                    <a href="#" onclick="showTab('game-groups', this, event)" class="sub-nav-link block px-4 py-2 text-gray-700 hover:bg-gray-100">Phân Loại Nhóm</a>
                    <a href="#" onclick="showTab('game-te', this, event)" class="sub-nav-link block px-4 py-2 text-gray-700 hover:bg-gray-100">Chia Thể て</a>
                </div>
            </div>
            <!-- Phản xạ Dropdown -->
            <div class="relative group">
                <button id="main-nav-reflex" class="main-nav-btn flex items-center space-x-2 w-full text-left px-4 py-2 text-lg font-semibold rounded-md hover:bg-blue-100 transition"><span>Phản xạ</span></button>
                <div class="dropdown-menu absolute z-10 bg-white shadow-lg rounded-md mt-1 w-48 py-1">
                    <a href="#" onclick="showTab('game-reflex', this, event)" class="sub-nav-link block px-4 py-2 text-gray-700 hover:bg-gray-100">Luyện Nghe</a>
                </div>
            </div>
        </nav>

        <main id="main-content">
            <!-- Theory: Verb Groups -->
            <div id="theory-groups" class="tab-content bg-white p-6 rounded-xl shadow-lg">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-blue-700">Lý Thuyết: 3 Nhóm Động Từ & Các Trường Hợp Đặc Biệt</h2>
                <div class="space-y-4 accordion-container">
                    <!-- Accordion Item 1 -->
                    <div class="accordion-item border rounded-lg overflow-hidden">
                        <button class="accordion-header w-full flex justify-between items-center p-4 bg-green-100 hover:bg-green-200 transition">
                            <span class="font-bold text-xl text-green-800">Nhóm 3 (Bất quy tắc)</span>
                            <svg class="accordion-icon w-6 h-6 text-green-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <p><strong class="font-semibold">Công thức:</strong> Nhóm này chỉ bao gồm 2 động từ gốc và các biến thể của します.</p>
                                <ul class="list-disc list-inside mt-2 pl-4 space-y-1">
                                    <li><code class="bg-gray-200 px-2 py-1 rounded">します</code> (làm) và các động từ có cấu trúc "Danh từ + します".</li>
                                    <li><code class="bg-gray-200 px-2 py-1 rounded">来ます (きます)</code> (đến).</li>
                                </ul>
                                <p class="mt-2"><strong class="font-semibold text-red-500">Chú ý:</strong> Nhóm này không có ngoại lệ. Chỉ cần nhớ hai trường hợp này là đủ.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion Item 2 -->
                    <div class="accordion-item border rounded-lg overflow-hidden">
                        <button class="accordion-header w-full flex justify-between items-center p-4 bg-yellow-100 hover:bg-yellow-200 transition">
                            <span class="font-bold text-xl text-yellow-800">Nhóm 2 (Ichidan)</span>
                            <svg class="accordion-icon w-6 h-6 text-yellow-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                             <div class="p-4">
                                <p><strong class="font-semibold">Công thức chính:</strong> Những động từ có âm tiết ngay trước <code class="bg-gray-200 px-2 py-1 rounded">ます</code> thuộc <strong>hàng え (e)</strong>.</p>
                                <p class="mt-4"><strong class="font-semibold text-red-500">Chú ý về ngoại lệ:</strong> Đây là nhóm có nhiều ngoại lệ cần ghi nhớ nhất. Các động từ này dù có âm trước <code class="bg-gray-200 px-2 py-1 rounded">ます</code> thuộc <strong>hàng い (i)</strong> nhưng vẫn được xếp vào Nhóm 2.</p>
                                <p class="mt-4"><strong>Danh sách các động từ ngoại lệ Nhóm 2 thường gặp:</strong></p>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2 mt-2 bg-yellow-50 p-4 rounded-md">
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">おきます</code><span>Thức dậy</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">おります</code><span>Xuống (xe)</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">あびます</code><span>Tắm</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">きます</code><span>Mặc</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">おちます</code><span>Rơi, rụng</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">います</code><span>Ở, có</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">かります</code><span>Mượn</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">できます</code><span>Có thể</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">みます</code><span>Nhìn, xem</span></div>
                                    <div class="flex justify-between border-b border-yellow-200 py-1"><code class="font-semibold text-yellow-900">たります</code><span>Đủ</span></div>
                                </div>
                                <div class="mt-6 p-4 bg-green-100 border-l-4 border-green-400 rounded">
                                    <h4 class="font-bold text-lg text-green-800">💡 Bài Thơ Mẹo Nhớ Ngoại Lệ Nhóm 2</h4>
                                    <p class="mt-2 italic leading-relaxed text-green-900">
                                        Sáng sớm <strong>thức dậy</strong> (<code class="text-sm bg-green-200 px-1 rounded">おきます</code>),<br>
                                        <strong>Xuống</strong> (<code class="text-sm bg-green-200 px-1 rounded">おります</code>) giường đi <strong>tắm</strong> (<code class="text-sm bg-green-200 px-1 rounded">あびます</code>).<br>
                                        <strong>Mặc</strong> (<code class="text-sm bg-green-200 px-1 rounded">きます</code>) quần áo thì tiền <strong>rơi</strong> (<code class="text-sm bg-green-200 px-1 rounded">おちます</code>) ra,<br>
                                        <strong>Có</strong> (<code class="text-sm bg-green-200 px-1 rounded">います</code>) bạn đến chơi,<br>
                                        Liền <strong>mượn</strong> (<code class="text-sm bg-green-200 px-1 rounded">かります</code>) bạn tiền,<br>
                                        Để <strong>có thể</strong> (<code class="text-sm bg-green-200 px-1 rounded">できます</code>) <strong>đủ</strong> (<code class="text-sm bg-green-200 px-1 rounded">たります</code>) 2 vé đi <strong>xem</strong> (<code class="text-sm bg-green-200 px-1 rounded">みます</code>) phim.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                     <!-- Accordion Item 3 -->
                    <div class="accordion-item border rounded-lg overflow-hidden">
                        <button class="accordion-header w-full flex justify-between items-center p-4 bg-purple-100 hover:bg-purple-200 transition">
                            <span class="font-bold text-xl text-purple-800">Nhóm 1 (Godan)</span>
                            <svg class="accordion-icon w-6 h-6 text-purple-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <p><strong class="font-semibold">Công thức:</strong> Bao gồm tất cả các động từ còn lại. Hầu hết các động từ này có âm tiết trước <code class="bg-gray-200 px-2 py-1 rounded">ます</code> thuộc <strong>hàng い (i)</strong>.</p>
                                 <p class="mt-4"><strong class="font-semibold text-red-500">Chú ý về ngoại lệ:</strong></p>
                                <ul class="list-disc list-inside mt-2 pl-4 space-y-2">
                                    <li>Ngoại lệ quan trọng nhất là phải <strong>loại trừ</strong> danh sách các động từ đặc biệt của Nhóm 2 đã nêu ở trên.</li>
                                    <li>Một số động từ trông giống Nhóm 2 (vì có âm <code class="bg-gray-200 px-1 rounded">え</code>) nhưng thực chất lại là Nhóm 1: <br><code class="bg-purple-100 text-purple-800 p-1 rounded">帰ります (かえります)</code>, <code class="bg-purple-100 text-purple-800 p-1 rounded">入ります (はいります)</code>, <code class="bg-purple-100 text-purple-800 p-1 rounded">知ります (しります)</code>, <code class="bg-purple-100 text-purple-800 p-1 rounded">切ります (きります)</code>.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Theory: Te Form -->
            <div id="theory-te" class="tab-content bg-white p-6 rounded-xl shadow-lg hidden">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-blue-700">Lý Thuyết: Chinh Phục Thể て</h2>
                 <div class="space-y-4 accordion-container">
                    <!-- Accordion Item 1 -->
                    <div class="accordion-item border rounded-lg overflow-hidden">
                        <button class="accordion-header w-full flex justify-between items-center p-4 bg-green-100 hover:bg-green-200 transition">
                            <span class="font-bold text-xl text-green-800">Nhóm 2 & 3 (Dễ nhất)</span>
                            <svg class="accordion-icon w-6 h-6 text-green-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <p><strong class="font-semibold">Công thức:</strong> Bỏ <code class="bg-gray-200 px-2 py-1 rounded">ます</code> thêm <code class="bg-green-200 px-2 py-1 rounded">て</code>.</p>
                                <ul class="list-disc list-inside mt-2 pl-4 space-y-1">
                                    <li>Nhóm 2: <code class="bg-gray-200 px-1 rounded">食べます</code> → <code class="bg-green-100 px-1 rounded">食べて</code></li>
                                    <li>Nhóm 3: <code class="bg-gray-200 px-1 rounded">勉強します</code> → <code class="bg-green-100 px-1 rounded">勉強して</code></li>
                                    <li>Ngoại lệ Nhóm 3: <code class="bg-gray-200 px-1 rounded">来ます (きます)</code> → <code class="bg-green-100 px-1 rounded">来て (きて)</code></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <!-- Accordion Item 2 -->
                    <div class="accordion-item border rounded-lg overflow-hidden">
                        <button class="accordion-header w-full flex justify-between items-center p-4 bg-purple-100 hover:bg-purple-200 transition">
                            <span class="font-bold text-xl text-purple-800">Nhóm 1 (Thử thách)</span>
                            <svg class="accordion-icon w-6 h-6 text-purple-800" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-4">
                                <p>Quy tắc chia phụ thuộc vào âm tiết cuối cùng đứng trước <code class="bg-gray-200 px-2 py-1 rounded">ます</code>.</p>
                                <div class="overflow-x-auto mt-4">
                                    <table class="w-full text-left border-collapse">
                                        <thead class="bg-purple-100">
                                            <tr>
                                                <th class="p-3 font-bold uppercase text-purple-800 border border-purple-200">Âm tiết trước ます</th>
                                                <th class="p-3 font-bold uppercase text-purple-800 border border-purple-200">Chuyển thành</th>
                                                <th class="p-3 font-bold uppercase text-purple-800 border border-purple-200">Ví dụ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="hover:bg-gray-50">
                                                <td class="p-3 border border-purple-200 font-mono">い・ち・り</td>
                                                <td class="p-3 border border-purple-200 font-mono text-red-600 font-bold">って</td>
                                                <td class="p-3 border border-purple-200">会います → 会って</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50">
                                                <td class="p-3 border border-purple-200 font-mono">に・び・み</td>
                                                <td class="p-3 border border-purple-200 font-mono text-red-600 font-bold">んで</td>
                                                <td class="p-3 border border-purple-200">飲みます → 飲んで</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50">
                                                <td class="p-3 border border-purple-200 font-mono">き</td>
                                                <td class="p-3 border border-purple-200 font-mono text-red-600 font-bold">いて</td>
                                                <td class="p-3 border border-purple-200">書きます → 書いて</td>
                                            </tr>
                                             <tr class="hover:bg-gray-50">
                                                <td class="p-3 border border-purple-200 font-mono">ぎ</td>
                                                <td class="p-3 border border-purple-200 font-mono text-red-600 font-bold">いで</td>
                                                <td class="p-3 border border-purple-200">泳ぎます → 泳いで</td>
                                            </tr>
                                            <tr class="hover:bg-gray-50">
                                                <td class="p-3 border border-purple-200 font-mono">し</td>
                                                <td class="p-3 border border-purple-200 font-mono text-red-600 font-bold">して</td>
                                                <td class="p-3 border border-purple-200">話します → 話して</td>
                                            </tr>
                                            <tr class="bg-red-50 hover:bg-red-100">
                                                <td class="p-3 border border-purple-200 font-mono font-bold">Đặc biệt: 行きます</td>
                                                <td class="p-3 border border-purple-200 font-mono text-red-600 font-bold">いって</td>
                                                <td class="p-3 border border-purple-200">行きます → 行って</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="mt-6 p-4 bg-yellow-100 border-l-4 border-yellow-400 rounded">
                                    <h4 class="font-bold text-lg text-yellow-800">🎵 Bài Hát Mẹo Nhớ</h4>
                                    <p class="mt-2 italic">
                                        I, chi, ri → <strong class="text-red-600">tte</strong>, Ni, bi, mi → <strong class="text-red-600">n de</strong>,<br>
                                        Ki → <strong class="text-red-600">ite</strong>, Gi → <strong class="text-red-600">ide</strong>.<br>
                                        Ikimasu → <strong class="text-red-600">itte</strong>, Ikimasu → <strong class="text-red-600">itte</strong>,<br>
                                        Shi, shi → <strong class="text-red-600">te</strong>, Shi, shi → <strong class="text-red-600">te</strong>.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Game: Irregular Verbs -->
            <div id="game-irregular" class="tab-content bg-white p-6 rounded-xl shadow-lg hidden">
                <h2 class="text-2xl md:text-3xl font-bold mb-2 text-center">Game: Săn Lùng Động Từ Nhóm 2 Đặc Biệt</h2>
                <p class="text-center text-gray-600 mb-6">Hãy chọn tất cả các động từ Nhóm 2 có kết thúc là hàng <strong>い</strong> (i) nhé!</p>
                <div id="irregular-verb-grid" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-4">
                    <!-- Verbs will be injected here by JS -->
                </div>
                <div class="text-center mt-8 flex justify-center items-center gap-4">
                    <button id="check-irregular-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg hover:scale-105">Kiểm tra</button>
                    <button id="reset-irregular-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg hover:scale-105">Chơi lại</button>
                </div>
                <div id="irregular-feedback" class="mt-6 text-center font-semibold text-lg"></div>
            </div>

            <!-- Game: Group Classification -->
            <div id="game-groups" class="tab-content bg-white p-6 rounded-xl shadow-lg hidden">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">Game: Động Từ Này Thuộc Nhóm Nào?</h2>
                <div id="group-game-container" class="text-center">
                    <div id="group-question-card" class="bg-blue-50 p-6 rounded-lg min-h-[150px] flex flex-col justify-center">
                        <p class="text-lg mb-2">Động từ:</p>
                        <p id="group-question-verb" class="text-4xl font-bold text-blue-800 mb-1"></p>
                        <p id="group-question-meaning" class="text-gray-600 text-xl"></p>
                    </div>
                    <div id="group-answers" class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                        <!-- Answer buttons will be injected here -->
                    </div>
                    <div id="group-feedback" class="mt-6 p-4 rounded-lg border-l-4 hidden"></div>
                    <button id="group-next-btn" class="hidden mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition hover:scale-105">Câu tiếp theo</button>
                </div>
                 <div class="text-center mt-6">
                    <button onclick="startGroupGame()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg hover:scale-105">Bắt đầu / Chơi lại</button>
                </div>
            </div>

            <!-- Game: Te Form Conjugation -->
            <div id="game-te" class="tab-content bg-white p-6 rounded-xl shadow-lg hidden">
                <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">Game: Chia Thể て</h2>
                <div id="te-game-container" class="text-center">
                    <div id="te-question-card" class="bg-yellow-50 p-6 rounded-lg min-h-[150px] flex flex-col justify-center">
                        <p class="text-lg mb-2">Thể て của động từ sau là gì?</p>
                        <p id="te-question-verb" class="text-4xl font-bold text-yellow-800"></p>
                    </div>
                    <div id="te-answers" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                        <!-- Answer buttons will be injected here -->
                    </div>
                    <div id="te-feedback" class="mt-6 p-4 rounded-lg border-l-4 hidden"></div>
                    <button id="te-next-btn" class="hidden mt-4 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition hover:scale-105">Câu tiếp theo</button>
                </div>
                 <div class="text-center mt-6">
                    <button onclick="startTeGame()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg transition shadow-lg hover:scale-105">Bắt đầu / Chơi lại</button>
                </div>
            </div>

            <!-- Game: Listening Reflex -->
            <div id="game-reflex" class="tab-content bg-white p-6 rounded-xl shadow-lg hidden">
                 <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">Game: Luyện Phản Xạ Nghe</h2>
                 <div id="reflex-game-container" class="text-center">
                    <div class="min-h-[250px] flex flex-col items-center justify-center bg-gray-50 rounded-lg p-6">
                        <div id="reflex-start-view">
                             <p class="mb-4 text-gray-600">Nhấn nút bên dưới để nghe động từ và luyện phản xạ trong 5 giây.</p>
                             <button id="reflex-start-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-10 rounded-full transition shadow-xl text-lg hover:scale-105">BẮT ĐẦU</button>
                        </div>
                        <div id="reflex-playing-view" class="hidden">
                            <p class="text-2xl text-gray-700 mb-4">Lắng nghe và suy nghĩ...</p>
                            <div id="reflex-timer" class="text-6xl font-bold text-red-500">5</div>
                        </div>
                        <div id="reflex-result-view" class="hidden text-center">
                             <p class="text-2xl font-bold text-gray-800 mb-2" id="reflex-result-verb"></p>
                             <p class="text-5xl font-bold text-green-600" id="reflex-result-te"></p>
                             <button id="reflex-next-btn" class="mt-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition hover:scale-105">Tiếp tục</button>
                        </div>
                    </div>
                 </div>
            </div>

        </main>
    </div>

    <script>
        // --- DATABASE ---
        const verbs = [
            { id: 1, kanji: '行きます', hiragana: 'いきます', meaning: 'Đi', group: 1, reason: 'Đây là động từ đặc biệt của nhóm 1 khi chia thể て.', te_form: 'いって' },
            { id: 2, kanji: '寝ます', hiragana: 'ねます', meaning: 'Ngủ', group: 2, reason: 'Âm tiết trước ます là ね (ne) thuộc cột え (e).', te_form: 'ねて' },
            { id: 3, kanji: '働きます', hiragana: 'はたらきます', meaning: 'Làm việc', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'はたらいて' },
            { id: 4, kanji: '終わります', hiragana: 'おわります', meaning: 'Kết thúc', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'おわって' },
            { id: 5, kanji: '勉強します', hiragana: 'べんきょうします', meaning: 'Học', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'べんきょうして' },
            { id: 6, kanji: 'します', hiragana: 'します', meaning: 'Làm', group: 3, reason: 'Đây là động từ gốc của nhóm 3.', te_form: 'して' },
            { id: 7, kanji: '起きます', hiragana: 'おきます', meaning: 'Thức dậy', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là き (ki), nó vẫn thuộc nhóm 2.', te_form: 'おきて' },
            { id: 8, kanji: '来ます', hiragana: 'きます', meaning: 'Đến', group: 3, reason: 'Đây là động từ bất quy tắc gốc của nhóm 3.', te_form: 'きて' },
            { id: 9, kanji: '帰ります', hiragana: 'かえります', meaning: 'Về', group: 1, reason: 'Đây là động từ đặc biệt của nhóm 1. Dù có âm え (e), nó vẫn thuộc nhóm 1.', te_form: 'かえって' },
            { id: 10, kanji: '食べます', hiragana: 'たべます', meaning: 'Ăn', group: 2, reason: 'Âm tiết trước ます là べ (be) thuộc cột え (e).', te_form: 'たべて' },
            { id: 11, kanji: '飲みます', hiragana: 'のみます', meaning: 'Uống', group: 1, reason: 'Âm tiết trước ます là み (mi) thuộc cột い (i).', te_form: 'のんで' },
            { id: 12, kanji: '見ます', hiragana: 'みます', meaning: 'Nhìn', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là み (mi), nó vẫn thuộc nhóm 2.', te_form: 'みて' },
            { id: 13, kanji: '聞きます', hiragana: 'ききます', meaning: 'Nghe', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'きいて' },
            { id: 14, kanji: '読みます', hiragana: 'よみます', meaning: 'Đọc', group: 1, reason: 'Âm tiết trước ます là み (mi) thuộc cột い (i).', te_form: 'よんで' },
            { id: 15, kanji: '書きます', hiragana: 'かきます', meaning: 'Viết', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'かいて' },
            { id: 16, kanji: '会います', hiragana: 'あいます', meaning: 'Gặp', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'あって' },
            { id: 17, kanji: '撮ります', hiragana: 'とります', meaning: 'Chụp', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'とって' },
            { id: 18, kanji: '切ります', hiragana: 'きります', meaning: 'Cắt', group: 1, reason: 'Đây là động từ đặc biệt của nhóm 1. Dù có âm い (i), nó vẫn thuộc nhóm 1.', te_form: 'きって' },
            { id: 19, kanji: '送ります', hiragana: 'おくります', meaning: 'Gửi', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'おくって' },
            { id: 20, kanji: 'あげます', hiragana: 'あげます', meaning: 'Tặng', group: 2, reason: 'Âm tiết trước ます là げ (ge) thuộc cột え (e).', te_form: 'あげて' },
            { id: 21, kanji: '買い物します', hiragana: 'かいものします', meaning: 'Mua sắm', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'かいものして' },
            { id: 22, kanji: 'もらいます', hiragana: 'もらいます', meaning: 'Nhận', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'もらって' },
            { id: 23, kanji: '教えます', hiragana: 'おしえます', meaning: 'Dạy', group: 2, reason: 'Âm tiết trước ます là え (e) thuộc cột え (e).', te_form: 'おしえて' },
            { id: 24, kanji: '習います', hiragana: 'ならいます', meaning: 'Học', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'ならって' },
            { id: 25, kanji: '借ります', hiragana: 'かります', meaning: 'Mượn', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là り (ri), nó vẫn thuộc nhóm 2.', te_form: 'かりて' },
            { id: 26, kanji: '貸します', hiragana: 'かします', meaning: 'Cho mượn', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'かして' },
            { id: 27, kanji: '食事します', hiragana: 'しょくじします', meaning: 'Dùng bữa', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'しょくじして' },
            { id: 28, kanji: 'かけます', hiragana: 'かけます', meaning: 'Gọi', group: 2, reason: 'Âm tiết trước ます là け (ke) thuộc cột え (e).', te_form: 'かけて' },
            { id: 29, kanji: 'わかります', hiragana: 'わかります', meaning: 'Hiểu', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'わかって' },
            { id: 30, kanji: 'あります', hiragana: 'あります', meaning: 'Có (đồ vật)', group: 1, reason: 'Đây là động từ đặc biệt của nhóm 1.', te_form: 'あって' },
            { id: 31, kanji: 'います', hiragana: 'います', meaning: 'Ở (người)', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là い (i), nó vẫn thuộc nhóm 2.', te_form: 'いて' },
            { id: 32, kanji: 'かかります', hiragana: 'かかります', meaning: 'Tốn', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'かかって' },
            { id: 33, kanji: '休みます', hiragana: 'やすみます', meaning: 'Nghỉ', group: 1, reason: 'Âm tiết trước ます là み (mi) thuộc cột い (i).', te_form: 'やすんで' },
            { id: 34, kanji: '迎えます', hiragana: 'むかえます', meaning: 'Đón', group: 2, reason: 'Âm tiết trước ます là え (e) thuộc cột え (e).', te_form: 'むかえて' },
            { id: 35, kanji: '散歩します', hiragana: 'さんぽします', meaning: 'Đi dạo', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'さんぽして' },
            { id: 36, kanji: '結婚します', hiragana: 'けっこんします', meaning: 'Kết hôn', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'けっこんして' },
            { id: 37, kanji: '泳ぎます', hiragana: 'およぎます', meaning: 'Bơi', group: 1, reason: 'Âm tiết trước ます là ぎ (gi) thuộc cột い (i).', te_form: 'およいで' },
            { id: 38, kanji: '遊びます', hiragana: 'あそびます', meaning: 'Chơi', group: 1, reason: 'Âm tiết trước ます là び (bi) thuộc cột い (i).', te_form: 'あそんで' },
            { id: 39, kanji: '疲れます', hiragana: 'つかれます', meaning: 'Mệt', group: 2, reason: 'Âm tiết trước ます là れ (re) thuộc cột え (e).', te_form: 'つかれて' },
            { id: 40, kanji: 'つけます', hiragana: 'つけます', meaning: 'Bật', group: 2, reason: 'Âm tiết trước ます là け (ke) thuộc cột え (e).', te_form: 'つけて' },
            { id: 41, kanji: 'けします', hiragana: 'けします', meaning: 'Tắt', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'けして' },
            { id: 42, kanji: 'あけます', hiragana: 'あけます', meaning: 'Mở', group: 2, reason: 'Âm tiết trước ます là け (ke) thuộc cột え (e).', te_form: 'あけて' },
            { id: 43, kanji: 'しめます', hiragana: 'しめます', meaning: 'Đóng', group: 2, reason: 'Âm tiết trước ます là め (me) thuộc cột え (e).', te_form: 'しめて' },
            { id: 44, kanji: '急ぎます', hiragana: 'いそぎます', meaning: 'Vội', group: 1, reason: 'Âm tiết trước ます là ぎ (gi) thuộc cột い (i).', te_form: 'いそいで' },
            { id: 45, kanji: '待ちます', hiragana: 'まちます', meaning: 'Đợi', group: 1, reason: 'Âm tiết trước ます là ち (chi) thuộc cột い (i).', te_form: 'まって' },
            { id: 46, kanji: '持ちます', hiragana: 'もちます', meaning: 'Mang, cầm', group: 1, reason: 'Âm tiết trước ます là ち (chi) thuộc cột い (i).', te_form: 'もって' },
            { id: 47, kanji: '手伝います', hiragana: 'てつだいます', meaning: 'Giúp đỡ', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'てつだって' },
            { id: 48, kanji: '呼びます', hiragana: 'よびます', meaning: 'Gọi', group: 1, reason: 'Âm tiết trước ます là び (bi) thuộc cột い (i).', te_form: 'よんで' },
            { id: 49, kanji: '話します', hiragana: 'はなします', meaning: 'Nói chuyện', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'はなして' },
            { id: 50, kanji: '見せます', hiragana: 'みせます', meaning: 'Cho xem', group: 2, reason: 'Âm tiết trước ます là せ (se) thuộc cột え (e).', te_form: 'みせて' },
            { id: 51, kanji: '止めます', hiragana: 'とめます', meaning: 'Dừng', group: 2, reason: 'Âm tiết trước ます là め (me) thuộc cột え (e).', te_form: 'とめて' },
            { id: 52, kanji: '立ちます', hiragana: 'たちます', meaning: 'Đứng', group: 1, reason: 'Âm tiết trước ます là ち (chi) thuộc cột い (i).', te_form: 'たって' },
            { id: 53, kanji: '座ります', hiragana: 'すわります', meaning: 'Ngồi', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'すわって' },
            { id: 54, kanji: '入ります', hiragana: 'はいります', meaning: 'Vào', group: 1, reason: 'Đây là động từ đặc biệt của nhóm 1. Dù có âm い (i), nó vẫn thuộc nhóm 1.', te_form: 'はいって' },
            { id: 55, kanji: '降ります', hiragana: 'ふります', meaning: 'Rơi (mưa)', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'ふって' },
            { id: 56, kanji: '出ます', hiragana: 'でます', meaning: 'Ra', group: 2, reason: 'Âm tiết trước ます là で (de) thuộc cột え (e).', te_form: 'でて' },
            { id: 57, kanji: '作ります', hiragana: 'つくります', meaning: 'Làm, chế tạo', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'つくって' },
            { id: 58, kanji: '置きます', hiragana: 'おきます', meaning: 'Đặt, để', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'おいて' },
            { id: 59, kanji: '売ります', hiragana: 'うります', meaning: 'Bán', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'うって' },
            { id: 60, kanji: '知ります', hiragana: 'しります', meaning: 'Biết', group: 1, reason: 'Đây là động từ đặc biệt của nhóm 1. Dù có âm い (i), nó vẫn thuộc nhóm 1.', te_form: 'しって' },
            { id: 61, kanji: '住みます', hiragana: 'すみます', meaning: 'Sống', group: 1, reason: 'Âm tiết trước ます là み (mi) thuộc cột い (i).', te_form: 'すんで' },
            { id: 62, kanji: '研究します', hiragana: 'けんきゅうします', meaning: 'Nghiên cứu', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'けんきゅうして' },
            { id: 63, kanji: '乗ります', hiragana: 'のります', meaning: 'Lên (xe)', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'のって' },
            { id: 64, kanji: '降ります', hiragana: 'おります', meaning: 'Xuống (xe)', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là り (ri), nó vẫn thuộc nhóm 2.', te_form: 'おりて' },
            { id: 65, kanji: '乗り換えます', hiragana: 'のりかえます', meaning: 'Đổi (xe)', group: 2, reason: 'Âm tiết trước ます là え (e) thuộc cột え (e).', te_form: 'のりかえて' },
            { id: 66, kanji: '入れます', hiragana: 'いれます', meaning: 'Cho vào', group: 2, reason: 'Âm tiết trước ます là れ (re) thuộc cột え (e).', te_form: 'いれて' },
            { id: 67, kanji: '出します', hiragana: 'だします', meaning: 'Nộp, lấy ra', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'だして' },
            { id: 68, kanji: '下ろします', hiragana: 'おろします', meaning: 'Rút', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'おろして' },
            { id: 69, kanji: '電話します', hiragana: 'でんわします', meaning: 'Gọi điện thoại', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'でんわして' },
            { id: 70, kanji: '押します', hiragana: 'おします', meaning: 'Ấn', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'おして' },
            { id: 71, kanji: '見学します', hiragana: 'けんがくします', meaning: 'Kiến tập', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'けんがくして' },
            { id: 72, kanji: '始めます', hiragana: 'はじめます', meaning: 'Bắt đầu', group: 2, reason: 'Âm tiết trước ます là め (me) thuộc cột え (e).', te_form: 'はじめて' },
            { id: 73, kanji: '覚えます', hiragana: 'おぼえます', meaning: 'Nhớ', group: 2, reason: 'Âm tiết trước ます là え (e) thuộc cột え (e).', te_form: 'おぼえて' },
            { id: 74, kanji: '忘れます', hiragana: 'わすれます', meaning: 'Quên', group: 2, reason: 'Âm tiết trước ます là れ (re) thuộc cột え (e).', te_form: 'わすれて' },
            { id: 75, kanji: 'なくします', hiragana: 'なくします', meaning: 'Làm mất', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'なくして' },
            { id: 76, kanji: '払います', hiragana: 'はらいます', meaning: 'Trả tiền', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'はらって' },
            { id: 77, kanji: '脱ぎます', hiragana: 'ぬぎます', meaning: 'Cởi', group: 1, reason: 'Âm tiết trước ます là ぎ (gi) thuộc cột い (i).', te_form: 'ぬいで' },
            { id: 78, kanji: '出張します', hiragana: 'しゅっちょうします', meaning: 'Công tác', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'しゅっちょうして' },
            { id: 79, kanji: '残業します', hiragana: 'ざんぎょうします', meaning: 'Tăng ca', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'ざんぎょうして' },
            { id: 80, kanji: '出かけます', hiragana: 'でかけます', meaning: 'Ra ngoài', group: 2, reason: 'Âm tiết trước ます là け (ke) thuộc cột え (e).', te_form: 'でかけて' },
            { id: 81, kanji: '心配します', hiragana: 'しんぱいします', meaning: 'Lo lắng', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'しんぱいして' },
            { id: 82, kanji: '持って行きます', hiragana: 'もっていきます', meaning: 'Mang đi', group: 1, reason: 'Động từ ghép với 行きます.', te_form: 'もっていって' },
            { id: 83, kanji: '持って来ます', hiragana: 'もってきます', meaning: 'Mang đến', group: 3, reason: 'Động từ ghép với 来ます.', te_form: 'もってきて' },
            { id: 84, kanji: '持って帰ります', hiragana: 'もってかえります', meaning: 'Mang về', group: 1, reason: 'Động từ ghép với 帰ります.', te_form: 'もってかえって' },
            { id: 85, kanji: '洗います', hiragana: 'あらいます', meaning: 'Rửa', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'あらって' },
            { id: 86, kanji: '弾きます', hiragana: 'ひきます', meaning: 'Chơi (nhạc cụ)', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'ひいて' },
            { id: 87, kanji: '換えます', hiragana: 'かえます', meaning: 'Đổi', group: 2, reason: 'Âm tiết trước ます là え (e) thuộc cột え (e).', te_form: 'かえて' },
            { id: 88, kanji: '出来ます', hiragana: 'できます', meaning: 'Có thể', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là き (ki), nó vẫn thuộc nhóm 2.', te_form: 'できて' },
            { id: 89, kanji: '運転します', hiragana: 'うんてんします', meaning: 'Lái xe', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'うんてんして' },
            { id: 90, kanji: '予約します', hiragana: 'よやくします', meaning: 'Đặt', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'よやくして' },
            { id: 91, kanji: '捨てます', hiragana: 'すてます', meaning: 'Vứt', group: 2, reason: 'Âm tiết trước ます là て (te) thuộc cột え (e).', te_form: 'すてて' },
            { id: 92, kanji: '集めます', hiragana: 'あつめます', meaning: 'Sưu tầm, thu thập', group: 2, reason: 'Âm tiết trước ます là め (me) thuộc cột え (e).', te_form: 'あつめて' },
            { id: 93, kanji: '歌います', hiragana: 'うたいます', meaning: 'Hát', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'うたって' },
            { id: 94, kanji: '登ります', hiragana: 'のぼります', meaning: 'Leo', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'のぼって' },
            { id: 95, kanji: '止まります', hiragana: 'とまります', meaning: 'Dừng', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'とまって' },
            { id: 96, kanji: '掃除します', hiragana: 'そうじします', meaning: 'Dọn vệ sinh', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'そうじして' },
            { id: 97, kanji: '洗濯します', hiragana: 'せんたくします', meaning: 'Giặt quần áo', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'せんたくして' },
            { id: 98, kanji: 'なります', hiragana: 'なります', meaning: 'Trở nên, trở thành', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'なって' },
            { id: 99, kanji: '要ります', hiragana: 'いります', meaning: 'Cần', group: 1, reason: 'Đây là động từ đặc biệt của nhóm 1. Dù có âm い (i), nó vẫn thuộc nhóm 1.', te_form: 'いって' },
            { id: 100, kanji: '調べます', hiragana: 'しらべます', meaning: 'Tìm hiểu', group: 2, reason: 'Âm tiết trước ます là べ (be) thuộc cột え (e).', te_form: 'しらべて' },
            { id: 101, kanji: '修理します', hiragana: 'しゅうりします', meaning: 'Sửa chữa', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'しゅうりして' },
            { id: 102, kanji: '思います', hiragana: 'おもいます', meaning: 'Nghĩ', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'おもって' },
            { id: 103, kanji: '言います', hiragana: 'いいます', meaning: 'Nói', group: 1, reason: 'Âm tiết trước ます là い (i) thuộc cột い (i).', te_form: 'いって' },
            { id: 104, kanji: '勝ちます', hiragana: 'かちます', meaning: 'Thắng', group: 1, reason: 'Âm tiết trước ます là ち (chi) thuộc cột い (i).', te_form: 'かって' },
            { id: 105, kanji: '負けます', hiragana: 'まけます', meaning: 'Thua', group: 2, reason: 'Âm tiết trước ます là け (ke) thuộc cột え (e).', te_form: 'まけて' },
            { id: 106, kanji: '役に立ちます', hiragana: 'やくにたちます', meaning: 'Giúp ích', group: 1, reason: 'Động từ ghép với 立ちます.', te_form: 'やくにたって' },
            { id: 107, kanji: 'やめます', hiragana: 'やめます', meaning: 'Từ bỏ', group: 2, reason: 'Âm tiết trước ます là め (me) thuộc cột え (e).', te_form: 'やめて' },
            { id: 108, kanji: '動きます', hiragana: 'うごきます', meaning: 'Di chuyển', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'うごいて' },
            { id: 109, kanji: '気を付けます', hiragana: 'きをつけます', meaning: 'Chú ý', group: 2, reason: 'Âm tiết trước ます là け (ke) thuộc cột え (e).', te_form: 'きをつけて' },
            { id: 110, kanji: '留学します', hiragana: 'りゅうがくします', meaning: 'Du học', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'りゅうがくして' },
            { id: 111, kanji: '着ます', hiragana: 'きます', meaning: 'Mặc', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là き (ki), nó vẫn thuộc nhóm 2.', te_form: 'きて' },
            { id: 112, kanji: 'はきます', hiragana: 'はきます', meaning: 'Đeo, mặc (dưới)', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'はいて' },
            { id: 113, kanji: 'かぶります', hiragana: 'かぶります', meaning: 'Đội', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'かぶって' },
            { id: 114, kanji: 'かけます', hiragana: 'かけます', meaning: 'Treo', group: 2, reason: 'Âm tiết trước ます là け (ke) thuộc cột え (e).', te_form: 'かけて' },
            { id: 115, kanji: '生まれます', hiragana: 'うまれます', meaning: 'Sinh ra', group: 2, reason: 'Âm tiết trước ます là れ (re) thuộc cột え (e).', te_form: 'うまれて' },
            { id: 116, kanji: '回します', hiragana: 'まわします', meaning: 'Vặn, xoay', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'まわして' },
            { id: 117, kanji: '引きます', hiragana: 'ひきます', meaning: 'Kéo', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'ひいて' },
            { id: 118, kanji: '変えます', hiragana: 'かえます', meaning: 'Đổi', group: 2, reason: 'Âm tiết trước ます là え (e) thuộc cột え (e).', te_form: 'かえて' },
            { id: 119, kanji: '歩きます', hiragana: 'あるきます', meaning: 'Đi bộ', group: 1, reason: 'Âm tiết trước ます là き (ki) thuộc cột い (i).', te_form: 'あるいて' },
            { id: 120, kanji: '渡ります', hiragana: 'わたります', meaning: 'Qua đường', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'わたって' },
            { id: 121, kanji: '曲がります', hiragana: 'まがります', meaning: 'Rẽ', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'まがって' },
            { id: 122, kanji: '触ります', hiragana: 'さわります', meaning: 'Sờ', group: 1, reason: 'Âm tiết trước ます là り (ri) thuộc cột い (i).', te_form: 'さわって' },
            { id: 123, kanji: 'くれます', hiragana: 'くれます', meaning: 'Cho (tôi)', group: 2, reason: 'Âm tiết trước ます là れ (re) thuộc cột え (e).', te_form: 'くれて' },
            { id: 124, kanji: '直します', hiragana: 'なおします', meaning: 'Sửa', group: 1, reason: 'Âm tiết trước ます là し (shi) thuộc cột い (i).', te_form: 'なおして' },
            { id: 125, kanji: '連れて行きます', hiragana: 'つれていきます', meaning: 'Dẫn đi', group: 1, reason: 'Động từ ghép với 行きます.', te_form: 'つれていって' },
            { id: 126, kanji: '連れて来ます', hiragana: 'つれてきます', meaning: 'Dẫn đến', group: 3, reason: 'Động từ ghép với 来ます.', te_form: 'つれてきて' },
            { id: 127, kanji: '紹介します', hiragana: 'しょうかいします', meaning: 'Giới thiệu', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'しょうかいして' },
            { id: 128, kanji: '案内します', hiragana: 'あんないします', meaning: 'Hướng dẫn', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'あんないして' },
            { id: 129, kanji: '説明します', hiragana: 'せつめいします', meaning: 'Giải thích', group: 3, reason: 'Kết thúc bằng します (shimasu).', te_form: 'せつめいして' },
            { id: 130, kanji: '足ります', hiragana: 'たります', meaning: 'Đủ', group: 2, reason: 'Đây là động từ đặc biệt của nhóm 2. Dù âm trước ます là り (ri), nó vẫn thuộc nhóm 2.', te_form: 'たりて' },
        ];
        
        // --- GLOBAL STATE ---
        let speech = new SpeechSynthesisUtterance();
        speech.lang = "ja-JP";
        speech.rate = 0.9;
        let isAudioUnlocked = false; // Flag to track audio unlock status for mobile

        // --- TAB MANAGEMENT ---
        function showTab(tabId, clickedElement, event) {
            if (event) {
                event.preventDefault();
            }
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
            
            document.querySelectorAll('.main-nav-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.sub-nav-link').forEach(link => link.classList.remove('active'));

            if (clickedElement) {
                clickedElement.classList.add('active');
            }

            if (tabId.startsWith('theory')) {
                document.getElementById('main-nav-theory').classList.add('active');
            } else if (tabId.startsWith('game')) {
                if (tabId === 'game-reflex') {
                    document.getElementById('main-nav-reflex').classList.add('active');
                } else {
                    document.getElementById('main-nav-game').classList.add('active');
                }
            }

            if (tabId === 'game-irregular') initIrregularGame();
            if (tabId === 'game-groups') startGroupGame();
            if (tabId === 'game-te') startTeGame();
            if (tabId === 'game-reflex') initReflexGame();
        }
        
        // --- ACCORDION ---
        function initAccordions() {
            const accordionHeaders = document.querySelectorAll('.accordion-header');
            accordionHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    header.classList.toggle('open');
                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            });
        }
        
        // --- GAME 0: IRREGULAR VERB FINDER ---
        const irregularGameVerbsPool = [
            { hiragana: 'おきます', isIrregular: true }, { hiragana: 'おります', isIrregular: true },
            { hiragana: 'あびます', isIrregular: true }, { hiragana: 'きます', isIrregular: true }, // 着ます
            { hiragana: 'おちます', isIrregular: true }, { hiragana: 'います', isIrregular: true },
            { hiragana: 'かります', isIrregular: true }, { hiragana: 'できます', isIrregular: true },
            { hiragana: 'たります', isIrregular: true }, { hiragana: 'みます', isIrregular: true },
            // Distractors
            { hiragana: 'かえります', isIrregular: false }, { hiragana: 'はなします', isIrregular: false },
            { hiragana: 'のみます', isIrregular: false }, { hiragana: 'きます', isIrregular: false }, // 来ます
            { hiragana: 'つくります', isIrregular: false }, { hiragana: 'はたらきます', isIrregular: false },
            { hiragana: 'おわります', isIrregular: false }, { hiragana: 'べんきょうします', isIrregular: false },
            { hiragana: 'ねます', isIrregular: false }, { hiragana: 'ききます', isIrregular: false }
        ];

        function initIrregularGame() {
            // Shuffle the pool and take 20 verbs for the game
            const gameVerbs = irregularGameVerbsPool.sort(() => 0.5 - Math.random());

            const grid = document.getElementById('irregular-verb-grid');
            const feedbackEl = document.getElementById('irregular-feedback');
            grid.innerHTML = '';
            feedbackEl.textContent = '';
            
            gameVerbs.forEach(verb => {
                const item = document.createElement('button');
                item.textContent = verb.hiragana;
                item.dataset.isIrregular = verb.isIrregular;
                // Reset classes to default state for re-playability
                item.className = 'verb-grid-item p-4 border-2 rounded-lg cursor-pointer text-xl font-bold bg-gray-100 hover:bg-blue-200';
                item.onclick = () => {
                    // Only allow selection if the game is active (not checked yet)
                    if (!grid.hasAttribute('data-checked')) {
                        item.classList.toggle('selected');
                    }
                };
                grid.appendChild(item);
            });
            // Reset checked state
            grid.removeAttribute('data-checked');
            document.getElementById('check-irregular-btn').disabled = false;
        }

        document.getElementById('check-irregular-btn').addEventListener('click', () => {
            const grid = document.getElementById('irregular-verb-grid');
            const items = grid.querySelectorAll('.verb-grid-item');
            let correctSelections = 0;
            const totalIrregulars = Array.from(items).filter(item => item.dataset.isIrregular === 'true').length;

            // Mark the grid as checked to disable further selections
            grid.setAttribute('data-checked', 'true');

            items.forEach(item => {
                const isSelected = item.classList.contains('selected');
                const isIrregular = item.dataset.isIrregular === 'true';

                // Remove selection and hover classes to apply feedback colors cleanly
                item.classList.remove('selected', 'bg-gray-100', 'hover:bg-blue-200');

                if (isSelected && isIrregular) {
                    item.classList.add('bg-green-300'); // Correctly selected
                    correctSelections++;
                } else if (isSelected && !isIrregular) {
                    item.classList.add('bg-red-300'); // Incorrectly selected
                } else if (!isSelected && isIrregular) {
                    item.classList.add('bg-yellow-300'); // Missed
                } else {
                    item.classList.add('bg-gray-100'); // Unselected and correct
                }
            });
            
            document.getElementById('irregular-feedback').textContent = `Bạn đã tìm đúng ${correctSelections} / ${totalIrregulars} động từ. (Xanh: Đúng, Đỏ: Sai, Vàng: Bỏ sót)`;
            document.getElementById('check-irregular-btn').disabled = true;
        });
        
        document.getElementById('reset-irregular-btn').addEventListener('click', initIrregularGame);

        // --- GAME 1: GROUP CLASSIFICATION ---
        let currentGroupGameVerb = null;
        function startGroupGame() {
            currentGroupGameVerb = verbs[Math.floor(Math.random() * verbs.length)];
            document.getElementById('group-question-verb').textContent = currentGroupGameVerb.hiragana;
            document.getElementById('group-question-meaning').textContent = `(${currentGroupGameVerb.meaning})`;
            const answersContainer = document.getElementById('group-answers');
            answersContainer.innerHTML = '';
            [1, 2, 3].forEach(groupNum => {
                const button = document.createElement('button');
                button.textContent = `Nhóm ${groupNum}`;
                button.className = 'w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-4 rounded-lg transition text-xl transform hover:scale-105';
                button.onclick = () => checkGroupAnswer(groupNum);
                answersContainer.appendChild(button);
            });
            document.getElementById('group-feedback').classList.add('hidden');
            document.getElementById('group-next-btn').classList.add('hidden');
        }

        function checkGroupAnswer(selectedGroup) {
            const feedbackEl = document.getElementById('group-feedback');
            const isCorrect = selectedGroup === currentGroupGameVerb.group;
            if (isCorrect) {
                feedbackEl.innerHTML = `<strong class="text-green-600">Chính xác!</strong> ${currentGroupGameVerb.reason}`;
                feedbackEl.className = 'mt-6 p-4 rounded-lg border-l-4 feedback-correct';
            } else {
                feedbackEl.innerHTML = `<strong class="text-red-600">Chưa đúng!</strong> Đáp án đúng là <strong>Nhóm ${currentGroupGameVerb.group}</strong>. <br>${currentGroupGameVerb.reason}`;
                feedbackEl.className = 'mt-6 p-4 rounded-lg border-l-4 feedback-incorrect';
            }
            feedbackEl.classList.remove('hidden');
            document.getElementById('group-next-btn').classList.remove('hidden');
            document.getElementById('group-answers').innerHTML = '';
        }
        
        document.getElementById('group-next-btn').addEventListener('click', startGroupGame);

        // --- GAME 2: TE-FORM CONJUGATION ---
        let currentTeGameVerb = null;
        function startTeGame() {
            currentTeGameVerb = verbs[Math.floor(Math.random() * verbs.length)];
            document.getElementById('te-question-verb').textContent = currentTeGameVerb.hiragana;
            const answersContainer = document.getElementById('te-answers');
            answersContainer.innerHTML = '';
            let options = [...new Set([
                currentTeGameVerb.te_form,
                currentTeGameVerb.hiragana + 'て',
                currentTeGameVerb.hiragana.replace(/ます$/, 'る'),
                currentTeGameVerb.group === 1 ? currentTeGameVerb.hiragana.replace(/ます$/, 'て') : currentTeGameVerb.hiragana.replace(/[い|ち|り]ます$/, 'って')
            ])].sort(() => Math.random() - 0.5);
            
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.className = 'w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-4 rounded-lg transition text-2xl transform hover:scale-105';
                button.onclick = () => checkTeAnswer(option);
                answersContainer.appendChild(button);
            });
            document.getElementById('te-feedback').classList.add('hidden');
            document.getElementById('te-next-btn').classList.add('hidden');
        }

        function checkTeAnswer(selectedAnswer) {
            const feedbackEl = document.getElementById('te-feedback');
            const isCorrect = selectedAnswer === currentTeGameVerb.te_form;
            if (isCorrect) {
                feedbackEl.innerHTML = `<strong class="text-green-600">Tuyệt vời!</strong> ${currentTeGameVerb.hiragana} (Nhóm ${currentTeGameVerb.group}) chia thành ${currentTeGameVerb.te_form}.`;
                feedbackEl.className = 'mt-6 p-4 rounded-lg border-l-4 feedback-correct';
            } else {
                feedbackEl.innerHTML = `<strong class="text-red-600">Sai rồi!</strong> Đáp án đúng là <strong>${currentTeGameVerb.te_form}</strong>. <br>Vì ${currentTeGameVerb.hiragana} thuộc nhóm ${currentTeGameVerb.group}, nên ta áp dụng quy tắc chia của nhóm đó.`;
                feedbackEl.className = 'mt-6 p-4 rounded-lg border-l-4 feedback-incorrect';
            }
            feedbackEl.classList.remove('hidden');
            document.getElementById('te-next-btn').classList.remove('hidden');
            document.getElementById('te-answers').innerHTML = '';
        }

        document.getElementById('te-next-btn').addEventListener('click', startTeGame);
        
        // --- GAME 3: REFLEX ---
        let reflexTimerInterval;
        function initReflexGame() {
            document.getElementById('reflex-start-view').classList.remove('hidden');
            document.getElementById('reflex-playing-view').classList.add('hidden');
            document.getElementById('reflex-result-view').classList.add('hidden');
            clearInterval(reflexTimerInterval);
        }

        function startReflexRound() {
            // Mobile browser audio unlock. Must be in a direct user interaction event.
            if (!isAudioUnlocked) {
                const unlockSpeech = new SpeechSynthesisUtterance('');
                unlockSpeech.volume = 0; // Play silently
                window.speechSynthesis.speak(unlockSpeech);
                isAudioUnlocked = true;
            }

            document.getElementById('reflex-start-view').classList.add('hidden');
            document.getElementById('reflex-result-view').classList.add('hidden');
            document.getElementById('reflex-playing-view').classList.remove('hidden');
            
            const verb = verbs[Math.floor(Math.random() * verbs.length)];
            speech.text = verb.hiragana;
            window.speechSynthesis.speak(speech);

            let timeLeft = 5;
            const timerEl = document.getElementById('reflex-timer');
            timerEl.textContent = timeLeft;
            reflexTimerInterval = setInterval(() => {
                timeLeft--;
                timerEl.textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(reflexTimerInterval);
                    showReflexResult(verb);
                }
            }, 1000);
        }

        function showReflexResult(verb) {
            document.getElementById('reflex-playing-view').classList.add('hidden');
            document.getElementById('reflex-result-view').classList.remove('hidden');
            document.getElementById('reflex-result-verb').textContent = `${verb.hiragana} (${verb.kanji})`;
            document.getElementById('reflex-result-te').textContent = verb.te_form;
        }

        document.getElementById('reflex-start-btn').addEventListener('click', startReflexRound);
        document.getElementById('reflex-next-btn').addEventListener('click', startReflexRound);

        // --- KEYBOARD SHORTCUTS ---
        function handleKeyPress(event) {
            if (event.code === 'Enter' || event.code === 'Space') {
                // Find the visible "next" button and click it
                const visibleNextButton = 
                    document.querySelector('#group-next-btn:not(.hidden)') ||
                    document.querySelector('#te-next-btn:not(.hidden)') ||
                    document.querySelector('#reflex-next-btn:not(.hidden)');

                if (visibleNextButton) {
                    event.preventDefault();
                    visibleNextButton.click();
                    return;
                }
                
                // If no "next" button, check for a visible "start" button in the reflex game
                const reflexStartButton = document.querySelector('#reflex-start-btn');
                if (reflexStartButton && !reflexStartButton.parentElement.classList.contains('hidden')) {
                     event.preventDefault();
                     reflexStartButton.click();
                }
            }
        }

        // --- INITIALIZATION ---
        window.onload = () => {
            const initialLink = document.getElementById('sub-nav-theory-groups');
            showTab('theory-groups', initialLink);
            initAccordions();
            document.addEventListener('keydown', handleKeyPress);
        };
    </script>

</body>
</html>
