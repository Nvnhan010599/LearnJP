<!DOCTYPE html>
<html lang="vi" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học Động Từ Tiếng Nhật N5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .main-content {
            display: none;
        }
        .main-content.active {
            display: block;
        }
        .btn {
            @apply px-4 py-2 rounded-lg font-semibold shadow-md transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-opacity-75;
        }
        .btn-primary {
            @apply bg-blue-500 text-white hover:bg-blue-600 focus:ring-blue-400;
        }
        .btn-secondary {
            @apply bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600;
        }
        .card {
            @apply bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden;
        }
        .nav-item {
            @apply flex items-center px-4 py-3 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg cursor-pointer transition-colors;
        }
        .nav-item.active {
            @apply bg-blue-500 text-white dark:bg-blue-600 dark:text-white;
        }
        .nav-item i {
            @apply w-6 text-center;
        }
        /* Ghi chú Editor */
        .note-tool-btn {
            @apply w-8 h-8 flex items-center justify-center rounded font-sans font-bold text-base hover:bg-gray-200 dark:hover:bg-gray-600;
        }
        .note-color-swatch {
            @apply w-5 h-5 rounded-full cursor-pointer border border-gray-400 dark:border-gray-500 hover:scale-110 transition-transform;
        }
        .note-color-picker-wrapper {
             @apply w-5 h-5 rounded-sm cursor-pointer border border-gray-400 dark:border-gray-500 hover:scale-110 transition-transform relative overflow-hidden;
        }
        input[type="color"] {
            position: absolute;
            top: -2px;
            left: -2px;
            width: 30px;
            height: 30px;
            border: none;
            cursor: pointer;
        }

        [contenteditable][placeholder]:empty:before {
            content: attr(placeholder);
            pointer-events: none;
            display: block; /* For Firefox */
            color: #9ca3af; /* text-gray-400 */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #555;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #333;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-white dark:bg-gray-800 shadow-md flex-shrink-0">
            <div class="p-6">
                <h1 class="text-2xl font-bold text-blue-500">N5 Verbs</h1>
                <p class="text-sm text-gray-500 dark:text-gray-400">Cùng chinh phục 130 động từ!</p>
            </div>
            <nav class="mt-6 px-4 space-y-2">
                <a class="nav-item active" data-target="overview">
                    <i class="fas fa-list-alt"></i><span class="ml-4">Tổng quan</span>
                </a>
                <a class="nav-item" data-target="progress">
                    <i class="fas fa-chart-line"></i><span class="ml-4">Tiến độ</span>
                </a>
                <a class="nav-item" data-target="learn">
                    <i class="fas fa-book-open"></i><span class="ml-4">Học tập</span>
                </a>
                <a class="nav-item" data-target="test-te">
                    <i class="fas fa-puzzle-piece"></i><span class="ml-4">Trắc nghiệm (Thể て)</span>
                </a>
                <a class="nav-item" data-target="test-nai">
                    <i class="fas fa-puzzle-piece"></i><span class="ml-4">Trắc nghiệm (Thể ない)</span>
                </a>
                <a class="nav-item" data-target="settings">
                    <i class="fas fa-cog"></i><span class="ml-4">Cài đặt</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-y-auto">
            <!-- Overview Section -->
            <div id="overview" class="main-content active">
                <h2 class="text-3xl font-bold mb-6">Tổng quan 130 động từ</h2>
                <div class="mb-4">
                    <input type="text" id="searchInput" class="w-full p-3 rounded-lg bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Tìm kiếm động từ (nghĩa, kanji, hiragana)...">
                </div>
                <div class="card">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                <tr>
                                    <th scope="col" class="px-6 py-3">STT</th>
                                    <th scope="col" class="px-6 py-3">Kanji</th>
                                    <th scope="col" class="px-6 py-3">Hiragana</th>
                                    <th scope="col" class="px-6 py-3">Nghĩa</th>
                                    <th scope="col" class="px-6 py-3">Chi tiết</th>
                                </tr>
                            </thead>
                            <tbody id="verbTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Progress Section -->
            <div id="progress" class="main-content">
                <h2 class="text-3xl font-bold mb-6">Tiến độ học tập</h2>
                <div class="card p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold">Tổng quan</h3>
                        <span id="progress-stats" class="font-semibold text-blue-500">0/130 từ đã thuộc</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700">
                        <div id="progress-bar" class="bg-blue-500 h-4 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Learn Section -->
            <div id="learn" class="main-content">
                <div id="pack-selection">
                    <h2 class="text-3xl font-bold mb-6">Học tập - Chọn gói từ</h2>
                    <div id="pack-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                        <!-- Pack buttons will be generated here -->
                    </div>
                </div>
                <div id="learning-session" class="hidden">
                    <!-- Learning interface will be generated here -->
                </div>
            </div>

            <!-- Test Te Section -->
            <div id="test-te" class="main-content"><h2 class="text-3xl font-bold mb-6">Trắc nghiệm Thể て</h2><div class="card p-6"><p class="text-center text-gray-500">Tính năng đang được phát triển.</p></div></div>
            <div id="test-nai" class="main-content"><h2 class="text-3xl font-bold mb-6">Trắc nghiệm Thể ない</h2><div class="card p-6"><p class="text-center text-gray-500">Tính năng đang được phát triển.</p></div></div>
            <div id="settings" class="main-content"><h2 class="text-3xl font-bold mb-6">Cài đặt</h2><div class="space-y-6"><div class="card p-6"><h3 class="text-xl font-semibold mb-4">Giao diện</h3><div class="flex items-center justify-between"><span>Chế độ tối (Dark Mode)</span><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="darkModeToggle" class="sr-only peer"><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div></label></div></div><div class="card p-6"><h3 class="text-xl font-semibold mb-4">Dữ liệu</h3><div class="flex space-x-4"><button id="exportDataBtn" class="btn btn-secondary flex-1"><i class="fas fa-download mr-2"></i> Xuất dữ liệu</button><button class="btn btn-secondary flex-1"><i class="fas fa-upload mr-2"></i> Nhập dữ liệu</button></div><p class="text-sm text-gray-500 mt-4">Tính năng "Nhập dữ liệu" đang được phát triển.</p></div><div class="card p-6"><h3 class="text-xl font-semibold mb-4">Thông tin tác giả</h3><p>Ứng dụng được tạo bởi Trợ lý AI.</p><p>Phiên bản: 1.5.1</p></div></div></div>
        </main>
    </div>

    <!-- Modal for Verb Details -->
    <div id="verbModal" class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm flex items-center justify-center hidden z-50 p-4">
        <div class="card w-full max-w-2xl max-h-full flex flex-col">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center flex-shrink-0">
                <h3 class="text-2xl font-bold" id="modal-title"></h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-800 dark:hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto" id="modal-body"></div>
             <div class="p-4 bg-gray-100 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 flex-shrink-0">
                <div id="notes-toolbar" class="flex items-center space-x-4 mb-2 p-2 bg-white dark:bg-gray-800 rounded-lg shadow-sm">
                    <button class="note-tool-btn" data-command="bold" title="In đậm">B</button>
                    <button class="note-tool-btn italic" data-command="italic" title="In nghiêng">I</button>
                    <button class="note-tool-btn underline" data-command="underline" title="Gạch chân">U</button>
                    <div class="h-6 w-px bg-gray-300 dark:bg-gray-600"></div>
                    <button class="note-color-swatch" data-color="#000000" style="background-color: #000000;" title="Đen"></button>
                    <button class="note-color-swatch" data-color="#EF4444" style="background-color: #EF4444;" title="Đỏ"></button>
                    <button class="note-color-swatch" data-color="#3B82F6" style="background-color: #3B82F6;" title="Xanh dương"></button>
                    <button class="note-color-swatch" data-color="#22C55E" style="background-color: #22C55E;" title="Xanh lá"></button>
                    <div class="note-color-picker-wrapper" style="background-color: #000000;">
                        <input type="color" id="note-color-picker" title="Chọn màu khác">
                    </div>
                </div>
                <div id="modal-notes" contenteditable="true" class="w-full p-3 h-28 rounded-lg bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 overflow-y-auto" placeholder="Thêm ghi chú cá nhân cho từ này..."></div>
            </div>
        </div>
    </div>

    <script>
        const verbData = [
            { id: 1, kanji: "行きます", hiragana: "いきます", meaning: "Đi", group: 1, dict: "行く", te: "行って", nai: "行かない", example: "毎日学校へ行きます。(Tôi đi đến trường mỗi ngày)" },
            { id: 2, kanji: "寝ます", hiragana: "ねます", meaning: "Ngủ", group: 2, dict: "寝る", te: "寝て", nai: "寝ない", example: "昨日は早く寝ました。(Hôm qua tôi đã ngủ sớm)" },
            { id: 3, kanji: "働きます", hiragana: "はたらきます", meaning: "Làm việc", group: 1, dict: "働く", te: "働いて", nai: "働かない", example: "父は銀行で働いています。(Bố tôi làm việc ở ngân hàng)" },
            { id: 4, kanji: "終わります", hiragana: "おわります", meaning: "Kết thúc", group: 1, dict: "終わる", te: "終わって", nai: "終わらない", example: "会議は何時に終わりますか。(Cuộc họp kết thúc lúc mấy giờ?)" },
            { id: 5, kanji: "勉強します", hiragana: "べんきょうします", meaning: "Học", group: 3, dict: "勉強する", te: "勉強して", nai: "勉強しない", example: "家で日本語を勉強します。(Tôi học tiếng Nhật ở nhà)" },
            { id: 6, kanji: "します", hiragana: "します", meaning: "Làm", group: 3, dict: "する", te: "して", nai: "しない", example: "週末何をしますか。(Cuối tuần bạn làm gì?)" },
            { id: 7, kanji: "起きます", hiragana: "おきます", meaning: "Thức dậy", group: 2, dict: "起きる", te: "起きて", nai: "起きない", example: "毎朝6時に起きます。(Mỗi sáng tôi thức dậy lúc 6 giờ)" },
            { id: 8, kanji: "来ます", hiragana: "きます", meaning: "Đến", group: 3, dict: "来る", te: "来て", nai: "来ない", example: "友達がうちに遊びに来ます。(Bạn bè đến nhà tôi chơi)" },
            { id: 9, kanji: "帰ります", hiragana: "かえります", meaning: "Về", group: 1, dict: "帰る", te: "帰って", nai: "帰らない", example: "仕事が終わって、うちに帰ります。(Sau khi xong việc, tôi về nhà)" },
            { id: 10, kanji: "食べます", hiragana: "たべます", meaning: "Ăn", group: 2, dict: "食べる", te: "食べて", nai: "食べない", example: "昼ご飯を食べましょう。(Cùng ăn trưa nào!)" },
            { id: 11, kanji: "飲みます", hiragana: "のみます", meaning: "Uống", group: 1, dict: "飲む", te: "飲んで", nai: "飲まない", example: "コーヒーを飲みますか。(Bạn có uống cà phê không?)" },
            { id: 12, kanji: "見ます", hiragana: "みます", meaning: "Nhìn, Xem", group: 2, dict: "見る", te: "見て", nai: "見ない", example: "毎晩テレビを見ます。(Mỗi tối tôi xem TV)" },
            { id: 13, kanji: "聞きます", hiragana: "ききます", meaning: "Nghe", group: 1, dict: "聞く", te: "聞いて", nai: "聞かない", example: "音楽を聞くのが好きです。(Tôi thích nghe nhạc)" },
            { id: 14, kanji: "読みます", hiragana: "よみます", meaning: "Đọc", group: 1, dict: "読む", te: "読んで", nai: "読まない", example: "本を読みます。(Tôi đọc sách)" },
            { id: 15, kanji: "書きます", hiragana: "かきます", meaning: "Viết", group: 1, dict: "書く", te: "書いて", nai: "書かない", example: "手紙を書きます。(Tôi viết thư)" },
            { id: 16, kanji: "会います", hiragana: "あいます", meaning: "Gặp", group: 1, dict: "会う", te: "会って", nai: "会わない", example: "友達に会います。(Tôi gặp bạn)" },
            { id: 17, kanji: "撮ります", hiragana: "とります", meaning: "Chụp (ảnh)", group: 1, dict: "撮る", te: "撮って", nai: "撮らない", example: "写真を撮ってもいいですか。(Tôi chụp ảnh có được không?)" },
            { id: 18, kanji: "切ります", hiragana: "きります", meaning: "Cắt", group: 1, dict: "切る", te: "切って", nai: "切らない", example: "紙を切ります。(Tôi cắt giấy)" },
            { id: 19, kanji: "送ります", hiragana: "おくります", meaning: "Gửi", group: 1, dict: "送る", te: "送って", nai: "送らない", example: "荷物を送ります。(Tôi gửi hành lý)" },
            { id: 20, kanji: "あげます", hiragana: "あげます", meaning: "Tặng, Cho", group: 2, dict: "あげる", te: "あげて", nai: "あげない", example: "友達にプレゼントをあげます。(Tôi tặng quà cho bạn)" },
            { id: 21, kanji: "買い物します", hiragana: "かいものします", meaning: "Mua sắm", group: 3, dict: "買い物する", te: "買い物して", nai: "買い物しない", example: "デパートで買い物をします。(Tôi mua sắm ở trung tâm thương mại)" },
            { id: 22, kanji: "もらいます", hiragana: "もらいます", meaning: "Nhận", group: 1, dict: "もらう", te: "もらって", nai: "もらわない", example: "母にセーターをもらいました。(Tôi đã nhận được áo len từ mẹ)" },
            { id: 23, kanji: "教えます", hiragana: "おしえます", meaning: "Chỉ, Dạy", group: 2, dict: "教える", te: "教えて", nai: "教えない", example: "先生は日本語を教えます。(Giáo viên dạy tiếng Nhật)" },
            { id: 24, kanji: "習います", hiragana: "ならいます", meaning: "Học (từ ai đó)", group: 1, dict: "習う", te: "習って", nai: "習わない", example: "山田先生に日本語を習います。(Tôi học tiếng Nhật từ thầy Yamada)" },
            { id: 25, kanji: "借ります", hiragana: "かります", meaning: "Mượn", group: 2, dict: "借りる", te: "借りて", nai: "借りない", example: "図書館で本を借ります。(Tôi mượn sách ở thư viện)" },
            { id: 26, kanji: "貸します", hiragana: "かします", meaning: "Cho mượn", group: 1, dict: "貸す", te: "貸して", nai: "貸さない", example: "友達にお金を貸します。(Tôi cho bạn mượn tiền)" },
            { id: 27, kanji: "食事します", hiragana: "しょくじします", meaning: "Dùng bữa", group: 3, dict: "食事する", te: "食事して", nai: "食事しない", example: "レストランで食事します。(Tôi dùng bữa ở nhà hàng)" },
            { id: 28, kanji: "かけます", hiragana: "かけます", meaning: "Gọi (điện thoại)", group: 2, dict: "かける", te: "かけて", nai: "かけない", example: "友達に電話をかけます。(Tôi gọi điện cho bạn)" },
            { id: 29, kanji: "わかります", hiragana: "わかります", meaning: "Hiểu", group: 1, dict: "わかる", te: "わかって", nai: "わからない", example: "日本語が少しわかります。(Tôi hiểu một chút tiếng Nhật)" },
            { id: 30, kanji: "あります", hiragana: "あります", meaning: "Có (đồ vật)", group: 1, dict: "ある", te: "あって", nai: "ない", example: "机の上に本があります。(Có quyển sách trên bàn)" },
            { id: 31, kanji: "います", hiragana: "います", meaning: "Có, Ở (người, động vật)", group: 2, dict: "いる", te: "いて", nai: "いない", example: "公園に子供がいます。(Có trẻ em ở công viên)" },
            { id: 32, kanji: "かかります", hiragana: "かかります", meaning: "Tốn (thời gian, tiền)", group: 1, dict: "かかる", te: "かかって", nai: "かからない", example: "駅からうちまで10分かかります。(Từ ga về nhà mất 10 phút)" },
            { id: 33, kanji: "休みます", hiragana: "やすみます", meaning: "Nghỉ", group: 1, dict: "休む", te: "休んで", nai: "休まない", example: "今日は会社を休みます。(Hôm nay tôi nghỉ làm)" },
            { id: 34, kanji: "迎えます", hiragana: "むかえます", meaning: "Đón", group: 2, dict: "迎える", te: "迎えて", nai: "迎えない", example: "空港へ友達を迎えに行きます。(Tôi đi đón bạn ở sân bay)" },
            { id: 35, kanji: "散歩します", hiragana: "さんぽします", meaning: "Đi dạo", group: 3, dict: "散歩する", te: "散歩して", nai: "散歩しない", example: "公園を散歩します。(Tôi đi dạo ở công viên)" },
            { id: 36, kanji: "結婚します", hiragana: "けっこんします", meaning: "Kết hôn", group: 3, dict: "結婚する", te: "結婚して", nai: "結婚しない", example: "来年結婚します。(Năm sau tôi sẽ kết hôn)" },
            { id: 37, kanji: "泳ぎます", hiragana: "およぎます", meaning: "Bơi", group: 1, dict: "泳ぐ", te: "泳いで", nai: "泳がない", example: "海で泳ぎたいです。(Tôi muốn bơi ở biển)" },
            { id: 38, kanji: "遊びます", hiragana: "あそびます", meaning: "Chơi", group: 1, dict: "遊ぶ", te: "遊んで", nai: "遊ばない", example: "子供たちは公園で遊んでいます。(Bọn trẻ đang chơi ở công viên)" },
            { id: 39, kanji: "疲れます", hiragana: "つかれます", meaning: "Mệt", group: 2, dict: "疲れる", te: "疲れて", nai: "疲れない", example: "仕事で疲れました。(Tôi mệt vì công việc)" },
            { id: 40, kanji: "つけます", hiragana: "つけます", meaning: "Bật", group: 2, dict: "つける", te: "つけて", nai: "つけない", example: "電気をつけてください。(Làm ơn hãy bật điện)" },
            { id: 41, kanji: "消します", hiragana: "けします", meaning: "Tắt", group: 1, dict: "消す", te: "消して", nai: "消さない", example: "テレビを消してください。(Làm ơn hãy tắt TV)" },
            { id: 42, kanji: "開けます", hiragana: "あけます", meaning: "Mở", group: 2, dict: "開ける", te: "開けて", nai: "開けない", example: "窓を開けてください。(Làm ơn hãy mở cửa sổ)" },
            { id: 43, kanji: "閉めます", hiragana: "しめます", meaning: "Đóng", group: 2, dict: "閉める", te: "閉めて", nai: "閉めない", example: "ドアを閉めてください。(Làm ơn hãy đóng cửa ra vào)" },
            { id: 44, kanji: "急ぎます", hiragana: "いそぎます", meaning: "Vội, Gấp", group: 1, dict: "急ぐ", te: "急いで", nai: "急がない", example: "急いでください。(Hãy nhanh lên!)" },
            { id: 45, kanji: "待ちます", hiragana: "まちます", meaning: "Đợi", group: 1, dict: "待つ", te: "待って", nai: "待たない", example: "ここで待ってください。(Xin hãy đợi ở đây)" },
            { id: 46, kanji: "持ちます", hiragana: "もちます", meaning: "Mang, Cầm", group: 1, dict: "持つ", te: "持って", nai: "持たない", example: "荷物を持ちましょうか。(Tôi mang hành lý giúp bạn nhé?)" },
            { id: 47, kanji: "手伝います", hiragana: "てつだいます", meaning: "Giúp đỡ", group: 1, dict: "手伝う", te: "手伝って", nai: "手伝わない", example: "宿題を手伝ってください。(Hãy giúp tôi làm bài tập)" },
            { id: 48, kanji: "呼びます", hiragana: "よびます", meaning: "Gọi", group: 1, dict: "呼ぶ", te: "呼んで", nai: "呼ばない", example: "タクシーを呼びましょう。(Hãy gọi taxi nào!)" },
            { id: 49, kanji: "話します", hiragana: "はなします", meaning: "Nói chuyện", group: 1, dict: "話す", te: "話して", nai: "話さない", example: "もっとゆっくり話してください。(Xin hãy nói chậm hơn)" },
            { id: 50, kanji: "見せます", hiragana: "みせます", meaning: "Cho xem", group: 2, dict: "見せる", te: "見せて", nai: "見せない", example: "写真を見せてください。(Hãy cho tôi xem ảnh)" },
            { id: 51, kanji: "止めます", hiragana: "とめます", meaning: "Dừng", group: 2, dict: "止める", te: "止めて", nai: "止めない", example: "ここに車を止めないでください。(Xin đừng đỗ xe ở đây)" },
            { id: 52, kanji: "立ちます", hiragana: "たちます", meaning: "Đứng", group: 1, dict: "立つ", te: "立って", nai: "立たない", example: "立ってください。(Xin mời đứng lên)" },
            { id: 53, kanji: "座ります", hiragana: "すわります", meaning: "Ngồi", group: 1, dict: "座る", te: "座って", nai: "座らない", example: "どうぞ座ってください。(Xin mời ngồi)" },
            { id: 54, kanji: "入ります", hiragana: "はいります", meaning: "Vào", group: 1, dict: "入る", te: "入って", nai: "入らない", example: "教室に入ります。(Tôi vào lớp học)" },
            { id: 55, kanji: "降ります", hiragana: "ふります", meaning: "Rơi (mưa, tuyết)", group: 1, dict: "降る", te: "降って", nai: "降らない", example: "雨が降っています。(Trời đang mưa)" },
            { id: 56, kanji: "出ます", hiragana: "でます", meaning: "Ra, Ra khỏi", group: 2, dict: "出る", te: "出て", nai: "出ない", example: "部屋を出ます。(Tôi ra khỏi phòng)" },
            { id: 57, kanji: "作ります", hiragana: "つくります", meaning: "Làm, Chế tạo", group: 1, dict: "作る", te: "作って", nai: "作らない", example: "料理を作ります。(Tôi nấu ăn)" },
            { id: 58, kanji: "置きます", hiragana: "おきます", meaning: "Đặt, Để", group: 1, dict: "置く", te: "置いて", nai: "置かない", example: "机の上に本を置きます。(Tôi đặt sách lên bàn)" },
            { id: 59, kanji: "売ります", hiragana: "うります", meaning: "Bán", group: 1, dict: "売る", te: "売って", nai: "売らない", example: "古い車を売りました。(Tôi đã bán chiếc xe ô tô cũ)" },
            { id: 60, kanji: "知ります", hiragana: "しります", meaning: "Biết", group: 1, dict: "知る", te: "知って", nai: "知らない", example: "彼の電話番号を知っていますか。(Bạn có biết số điện thoại của anh ấy không?)" },
            { id: 61, kanji: "住みます", hiragana: "すみます", meaning: "Sống", group: 1, dict: "住む", te: "住んで", nai: "住まない", example: "東京に住んでいます。(Tôi đang sống ở Tokyo)" },
            { id: 62, kanji: "研究します", hiragana: "けんきゅうします", meaning: "Nghiên cứu", group: 3, dict: "研究する", te: "研究して", nai: "研究しない", example: "大学で経済を研究しています。(Tôi đang nghiên cứu kinh tế ở đại học)" },
            { id: 63, kanji: "乗ります", hiragana: "のります", meaning: "Lên (xe)", group: 1, dict: "乗る", te: "乗って", nai: "乗らない", example: "電車に乗ります。(Tôi lên tàu điện)" },
            { id: 64, kanji: "降ります", hiragana: "おります", meaning: "Xuống (xe)", group: 2, dict: "降りる", te: "降りて", nai: "降りない", example: "次の駅で降ります。(Tôi xuống ở ga tiếp theo)" },
            { id: 65, kanji: "乗り換えます", hiragana: "のりかえます", meaning: "Chuyển (xe)", group: 2, dict: "乗り換える", te: "乗り換えて", nai: "乗り換えない", example: "新宿で電車を乗り換えます。(Tôi chuyển tàu ở Shinjuku)" },
            { id: 66, kanji: "入れます", hiragana: "いれます", meaning: "Cho vào", group: 2, dict: "入れる", te: "入れて", nai: "入れない", example: "かばんに本を入れます。(Tôi cho sách vào cặp)" },
            { id: 67, kanji: "出します", hiragana: "だします", meaning: "Lấy ra, Nộp", group: 1, dict: "出す", te: "出して", nai: "出さない", example: "レポートを出してください。(Hãy nộp báo cáo)" },
            { id: 68, kanji: "下ろします", hiragana: "おろします", meaning: "Rút (tiền)", group: 1, dict: "下ろす", te: "下ろして", nai: "下ろさない", example: "銀行でお金を下ろします。(Tôi rút tiền ở ngân hàng)" },
            { id: 69, kanji: "電話します", hiragana: "でんわします", meaning: "Gọi điện thoại", group: 3, dict: "電話する", te: "電話して", nai: "電話しない", example: "後で電話します。(Lát nữa tôi sẽ gọi điện)" },
            { id: 70, kanji: "押します", hiragana: "おします", meaning: "Ấn, Đẩy", group: 1, dict: "押す", te: "押して", nai: "押さない", example: "このボタンを押してください。(Hãy ấn nút này)" },
            { id: 71, kanji: "見学します", hiragana: "けんがくします", meaning: "Kiến tập", group: 3, dict: "見学する", te: "見学して", nai: "見学しない", example: "工場を見学します。(Tôi đi tham quan nhà máy)" },
            { id: 72, kanji: "始めます", hiragana: "はじめます", meaning: "Bắt đầu", group: 2, dict: "始める", te: "始めて", nai: "始めない", example: "授業を始めます。(Bắt đầu giờ học nào)" },
            { id: 73, kanji: "覚えます", hiragana: "おぼえます", meaning: "Nhớ", group: 2, dict: "覚える", te: "覚えて", nai: "覚えない", example: "新しい言葉を覚えます。(Tôi học từ mới)" },
            { id: 74, kanji: "忘れます", hiragana: "わすれます", meaning: "Quên", group: 2, dict: "忘れる", te: "忘れて", nai: "忘れない", example: "宿題を忘れました。(Tôi đã quên làm bài tập)" },
            { id: 75, kanji: "なくします", hiragana: "なくします", meaning: "Làm mất", group: 1, dict: "なくす", te: "なくして", nai: "なくさない", example: "財布をなくしました。(Tôi đã làm mất ví)" },
            { id: 76, kanji: "払います", hiragana: "はらいます", meaning: "Trả tiền", group: 1, dict: "払う", te: "払って", nai: "払わない", example: "カードで払います。(Tôi trả bằng thẻ)" },
            { id: 77, kanji: "脱ぎます", hiragana: "ぬぎます", meaning: "Cởi (quần áo, giày)", group: 1, dict: "脱ぐ", te: "脱いで", nai: "脱がない", example: "靴を脱いでください。(Xin hãy cởi giày)" },
            { id: 78, kanji: "出張します", hiragana: "しゅっちょうします", meaning: "Đi công tác", group: 3, dict: "出張する", te: "出張して", nai: "出張しない", example: "来週大阪へ出張します。(Tuần sau tôi đi công tác Osaka)" },
            { id: 79, kanji: "残業します", hiragana: "ざんぎょうします", meaning: "Làm thêm giờ", group: 3, dict: "残業する", te: "残業して", nai: "残業しない", example: "毎晩残業します。(Mỗi tối tôi đều làm thêm giờ)" },
            { id: 80, kanji: "出かけます", hiragana: "でかけます", meaning: "Ra ngoài", group: 2, dict: "出かける", te: "出かけて", nai: "出かけない", example: "日曜日に出かけます。(Tôi ra ngoài vào Chủ Nhật)" },
            { id: 81, kanji: "心配します", hiragana: "しんぱいします", meaning: "Lo lắng", group: 3, dict: "心配する", te: "心配して", nai: "心配しない", example: "心配しないでください。(Xin đừng lo lắng)" },
            { id: 82, kanji: "持って行きます", hiragana: "もっていきます", meaning: "Mang đi", group: 1, dict: "持って行く", te: "持って行って", nai: "持って行かない", example: "お弁当を持って行きます。(Tôi mang theo cơm hộp)" },
            { id: 83, kanji: "持って来ます", hiragana: "もってきます", meaning: "Mang đến", group: 3, dict: "持って来る", te: "持って来て", nai: "持って来ない", example: "宿題を持って来てください。(Hãy mang bài tập đến đây)" },
            { id: 84, kanji: "持って帰ります", hiragana: "もってかえります", meaning: "Mang về", group: 1, dict: "持って帰る", te: "持って帰って", nai: "持って帰らない", example: "お土産を持って帰ります。(Tôi mang quà về)" },
            { id: 85, kanji: "洗います", hiragana: "あらいます", meaning: "Rửa", group: 1, dict: "洗う", te: "洗って", nai: "洗わない", example: "手を洗います。(Tôi rửa tay)" },
            { id: 86, kanji: "弾きます", hiragana: "ひきます", meaning: "Chơi (nhạc cụ)", group: 1, dict: "弾く", te: "弾いて", nai: "弾かない", example: "ピアノを弾くことができます。(Tôi có thể chơi piano)" },
            { id: 87, kanji: "換えます", hiragana: "かえます", meaning: "Đổi", group: 2, dict: "換える", te: "換えて", nai: "換えない", example: "ドルを円に換えます。(Tôi đổi đô la sang yên)" },
            { id: 88, kanji: "出来ます", hiragana: "できます", meaning: "Có thể", group: 2, dict: "できる", te: "できて", nai: "できない", example: "日本語ができます。(Tôi có thể nói tiếng Nhật)" },
            { id: 89, kanji: "運転します", hiragana: "うんてんします", meaning: "Lái xe", group: 3, dict: "運転する", te: "運転して", nai: "運転しない", example: "車を運転します。(Tôi lái xe ô tô)" },
            { id: 90, kanji: "予約します", hiragana: "よやくします", meaning: "Đặt trước", group: 3, dict: "予約する", te: "予約して", nai: "予約しない", example: "ホテルを予約します。(Tôi đặt khách sạn)" },
            { id: 91, kanji: "捨てます", hiragana: "すてます", meaning: "Vứt", group: 2, dict: "捨てる", te: "捨てて", nai: "捨てない", example: "ごみを捨てます。(Tôi vứt rác)" },
            { id: 92, kanji: "集めます", hiragana: "あつめます", meaning: "Sưu tầm", group: 2, dict: "集める", te: "集めて", nai: "集めない", example: "切手を集めています。(Tôi đang sưu tầm tem)" },
            { id: 93, kanji: "歌います", hiragana: "うたいます", meaning: "Hát", group: 1, dict: "歌う", te: "歌って", nai: "歌わない", example: "カラオケで歌います。(Tôi hát ở quán karaoke)" },
            { id: 94, kanji: "登ります", hiragana: "のぼります", meaning: "Leo (núi)", group: 1, dict: "登る", te: "登って", nai: "登らない", example: "富士山に登りたいです。(Tôi muốn leo núi Phú Sĩ)" },
            { id: 95, kanji: "泊まります", hiragana: "とまります", meaning: "Trọ lại", group: 1, dict: "泊まる", te: "泊まって", nai: "泊まらない", example: "ホテルに泊まります。(Tôi trọ lại ở khách sạn)" },
            { id: 96, kanji: "掃除します", hiragana: "そうじします", meaning: "Dọn dẹp", group: 3, dict: "掃除する", te: "掃除して", nai: "掃除しない", example: "部屋を掃除します。(Tôi dọn dẹp phòng)" },
            { id: 97, kanji: "洗濯します", hiragana: "せんたくします", meaning: "Giặt giũ", group: 3, dict: "洗濯する", te: "洗濯して", nai: "洗濯しない", example: "服を洗濯します。(Tôi giặt quần áo)" },
            { id: 98, kanji: "なります", hiragana: "なります", meaning: "Trở nên", group: 1, dict: "なる", te: "なって", nai: "ならない", example: "医者になりたいです。(Tôi muốn trở thành bác sĩ)" },
            { id: 99, kanji: "要ります", hiragana: "いります", meaning: "Cần", group: 1, dict: "要る", te: "要って", nai: "要らない", example: "ビザが要ります。(Cần có visa)" },
            { id: 100, kanji: "調べます", hiragana: "しらべます", meaning: "Tìm hiểu, Tra", group: 2, dict: "調べる", te: "調べて", nai: "調べない", example: "言葉の意味を調べます。(Tôi tra ý nghĩa của từ)" },
            { id: 101, kanji: "修理します", hiragana: "しゅうりします", meaning: "Sửa chữa", group: 3, dict: "修理する", te: "修理して", nai: "修理しない", example: "パソコンを修理します。(Tôi sửa máy tính)" },
            { id: 102, kanji: "思います", hiragana: "おもいます", meaning: "Nghĩ", group: 1, dict: "思う", te: "思って", nai: "思わない", example: "いいと思います。(Tôi nghĩ là được)" },
            { id: 103, kanji: "言います", hiragana: "いいます", meaning: "Nói", group: 1, dict: "言う", te: "言って", nai: "言わない", example: "もう一度言ってください。(Xin hãy nói lại lần nữa)" },
            { id: 104, kanji: "勝ちます", hiragana: "かちます", meaning: "Thắng", group: 1, dict: "勝つ", te: "勝って", nai: "勝たない", example: "試合に勝ちました。(Tôi đã thắng trận đấu)" },
            { id: 105, kanji: "負けます", hiragana: "まけます", meaning: "Thua", group: 2, dict: "負ける", te: "負けて", nai: "負けない", example: "試合に負けました。(Tôi đã thua trận đấu)" },
            { id: 106, kanji: "役に立ちます", hiragana: "やくにたちます", meaning: "Có ích", group: 1, dict: "役に立つ", te: "役に立って", nai: "役に立たない", example: "この辞書は役に立ちます。(Quyển từ điển này có ích)" },
            { id: 107, kanji: "やめます", hiragana: "やめます", meaning: "Bỏ, Thôi", group: 2, dict: "やめる", te: "やめて", nai: "やめない", example: "会社をやめました。(Tôi đã thôi việc ở công ty)" },
            { id: 108, kanji: "動きます", hiragana: "うごきます", meaning: "Di chuyển, Chuyển động", group: 1, dict: "動く", te: "動いて", nai: "動かない", example: "時計が動きません。(Cái đồng hồ không chạy)" },
            { id: 109, kanji: "気を付けます", hiragana: "きをつけます", meaning: "Chú ý", group: 2, dict: "気を付ける", te: "気を付けて", nai: "気を付けない", example: "車に気を付けてください。(Hãy chú ý ô tô)" },
            { id: 110, kanji: "留学します", hiragana: "りゅうがくします", meaning: "Du học", group: 3, dict: "留学する", te: "留学して", nai: "留学しない", example: "日本へ留学します。(Tôi đi du học Nhật Bản)" },
            { id: 111, kanji: "着ます", hiragana: "きます", meaning: "Mặc (áo)", group: 2, dict: "着る", te: "着て", nai: "着ない", example: "シャツを着ます。(Tôi mặc áo sơ mi)" },
            { id: 112, kanji: "はきます", hiragana: "はきます", meaning: "Mặc, Đi (quần, giày)", group: 1, dict: "はく", te: "はいて", nai: "はかない", example: "ズボンをはきます。(Tôi mặc quần)" },
            { id: 113, kanji: "かぶります", hiragana: "かぶります", meaning: "Đội (mũ)", group: 1, dict: "かぶる", te: "かぶって", nai: "かぶらない", example: "帽子をかぶります。(Tôi đội mũ)" },
            { id: 114, kanji: "かけます", hiragana: "かけます", meaning: "Đeo (kính)", group: 2, dict: "かける", te: "かけて", nai: "かけない", example: "眼鏡をかけます。(Tôi đeo kính)" },
            { id: 115, kanji: "生まれます", hiragana: "うまれます", meaning: "Sinh ra", group: 2, dict: "生まれる", te: "生まれて", nai: "生まれない", example: "私は1990年に生まれました。(Tôi sinh năm 1990)" },
            { id: 116, kanji: "回します", hiragana: "まわします", meaning: "Vặn, Xoay", group: 1, dict: "回す", te: "回して", nai: "回さない", example: "つまみを回します。(Tôi vặn núm)" },
            { id: 117, kanji: "引きます", hiragana: "ひきます", meaning: "Kéo", group: 1, dict: "引く", te: "引いて", nai: "引かない", example: "ドアを引きます。(Tôi kéo cửa)" },
            { id: 118, kanji: "変えます", hiragana: "かえます", meaning: "Thay đổi", group: 2, dict: "変える", te: "変えて", nai: "変えない", example: "予定を変えます。(Tôi thay đổi kế hoạch)" },
            { id: 119, kanji: "歩きます", hiragana: "あるきます", meaning: "Đi bộ", group: 1, dict: "歩く", te: "歩いて", nai: "歩かない", example: "駅まで歩きます。(Tôi đi bộ đến ga)" },
            { id: 120, kanji: "渡ります", hiragana: "わたります", meaning: "Qua (cầu, đường)", group: 1, dict: "渡る", te: "渡って", nai: "渡らない", example: "橋を渡ります。(Tôi đi qua cầu)" },
            { id: 121, kanji: "曲がります", hiragana: "まがります", meaning: "Rẽ", group: 1, dict: "曲がる", te: "曲がって", nai: "曲がらない", example: "角を右に曲がります。(Tôi rẽ phải ở góc đường)" },
            { id: 122, kanji: "触ります", hiragana: "さわります", meaning: "Sờ, Chạm", group: 1, dict: "触る", te: "触って", nai: "触らない", example: "絵に触らないでください。(Xin đừng chạm vào tranh)" },
            { id: 123, kanji: "くれます", hiragana: "くれます", meaning: "Cho (tôi)", group: 2, dict: "くれる", te: "くれて", nai: "くれない", example: "友達がプレゼントをくれました。(Bạn đã tặng quà cho tôi)" },
            { id: 124, kanji: "直します", hiragana: "なおします", meaning: "Sửa", group: 1, dict: "直す", te: "直して", nai: "直さない", example: "時計を直します。(Tôi sửa đồng hồ)" },
            { id: 125, kanji: "連れて行きます", hiragana: "つれていきます", meaning: "Dẫn đi", group: 1, dict: "連れて行く", te: "連れて行って", nai: "連れて行かない", example: "子供を公園へ連れて行きます。(Tôi dẫn con đi công viên)" },
            { id: 126, kanji: "連れて来ます", hiragana: "つれてきます", meaning: "Dẫn đến", group: 3, dict: "連れて来る", te: "連れて来て", nai: "連れて来ない", example: "友達をパーティーに連れて来ます。(Tôi dẫn bạn đến bữa tiệc)" },
            { id: 127, kanji: "紹介します", hiragana: "しょうかいします", meaning: "Giới thiệu", group: 3, dict: "紹介する", te: "紹介して", nai: "紹介しない", example: "友達を紹介します。(Tôi giới thiệu bạn bè)" },
            { id: 128, kanji: "案内します", hiragana: "あんないします", meaning: "Hướng dẫn", group: 3, dict: "案内する", te: "案内して", nai: "案内しない", example: "町を案内します。(Tôi sẽ hướng dẫn bạn về thị trấn)" },
            { id: 129, kanji: "説明します", hiragana: "せつめいします", meaning: "Giải thích", group: 3, dict: "説明する", te: "説明して", nai: "説明しない", example: "理由を説明します。(Tôi sẽ giải thích lý do)" },
            { id: 130, kanji: "足ります", hiragana: "たります", meaning: "Đủ", group: 2, dict: "足りる", te: "足りて", nai: "足りない", example: "お金が足りません。(Tôi không đủ tiền)" },
        ];

        document.addEventListener('DOMContentLoaded', function() {
            let currentVerbId = null; // Biến để theo dõi verb ID hiện tại trong modal

            const navItems = document.querySelectorAll('.nav-item');
            const mainContents = document.querySelectorAll('.main-content');
            const verbTableBody = document.getElementById('verbTableBody');
            const searchInput = document.getElementById('searchInput');
            const verbModal = document.getElementById('verbModal');
            const closeModalBtn = document.getElementById('closeModal');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const notesToolbar = document.getElementById('notes-toolbar');
            const noteColorPicker = document.getElementById('note-color-picker');
            const notesEditor = document.getElementById('modal-notes');
            const exportDataBtn = document.getElementById('exportDataBtn');

            // --- Dark Mode ---
            const applyTheme = (isDark) => {
                document.documentElement.classList.toggle('dark', isDark);
            };

            darkModeToggle.addEventListener('change', (e) => {
                localStorage.setItem('darkMode', e.target.checked);
                applyTheme(e.target.checked);
            });

            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            darkModeToggle.checked = savedDarkMode;
            applyTheme(savedDarkMode);

            // --- Navigation ---
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    navItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    const targetId = item.getAttribute('data-target');
                    mainContents.forEach(content => {
                        content.classList.toggle('active', content.id === targetId);
                    });
                });
            });

            // --- Verb Table and Modal ---
            const renderTable = (filter = '') => {
                verbTableBody.innerHTML = '';
                const lowerCaseFilter = filter.toLowerCase();
                const filteredData = verbData.filter(v => 
                    v.kanji.includes(filter) || 
                    v.hiragana.includes(filter) || 
                    v.meaning.toLowerCase().includes(lowerCaseFilter)
                );

                filteredData.forEach(verb => {
                    const row = document.createElement('tr');
                    row.className = 'bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600';
                    row.innerHTML = `
                        <td class="px-6 py-4">${verb.id}</td>
                        <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">${verb.kanji}</td>
                        <td class="px-6 py-4">${verb.hiragana}</td>
                        <td class="px-6 py-4">${verb.meaning}</td>
                        <td class="px-6 py-4">
                            <button class="btn btn-primary btn-sm view-details" data-id="${verb.id}">Xem</button>
                        </td>
                    `;
                    verbTableBody.appendChild(row);
                });
            };
            
            searchInput.addEventListener('input', (e) => renderTable(e.target.value));

            const openModal = (verbId) => {
                currentVerbId = parseInt(verbId);
                const verb = verbData.find(v => v.id === currentVerbId);
                if (!verb) return;

                document.getElementById('modal-title').innerText = `${verb.kanji} (${verb.hiragana})`;
                document.getElementById('modal-body').innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Nghĩa:</strong> ${verb.meaning}</div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Nhóm:</strong> ${verb.group}</div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Thể từ điển:</strong> ${verb.dict}</div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Thể て:</strong> ${verb.te}</div>
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg"><strong>Thể ない:</strong> ${verb.nai}</div>
                    </div>
                    <div class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <p><strong>Ví dụ:</strong></p>
                        <p>${verb.example}</p>
                    </div>
                `;
                
                // Load notes from localStorage
                const savedNote = localStorage.getItem(`verbNote_${currentVerbId}`) || '';
                notesEditor.innerHTML = savedNote;
                
                verbModal.classList.remove('hidden');
            };
            
            const closeModal = () => {
                // Save notes before closing
                if (currentVerbId) {
                    localStorage.setItem(`verbNote_${currentVerbId}`, notesEditor.innerHTML);
                }
                currentVerbId = null;
                verbModal.classList.add('hidden');
            };

            verbTableBody.addEventListener('click', (e) => {
                const viewButton = e.target.closest('.view-details');
                if (viewButton) {
                    openModal(viewButton.dataset.id);
                }
            });

            closeModalBtn.addEventListener('click', closeModal);
            verbModal.addEventListener('click', (e) => {
                if (e.target === verbModal) closeModal();
            });

            // --- Notes Editor ---
            notesToolbar.addEventListener('click', (e) => {
                const button = e.target.closest('.note-tool-btn');
                const swatch = e.target.closest('.note-color-swatch');

                if (button) {
                    const command = button.dataset.command;
                    document.execCommand(command, false, null);
                } else if (swatch) {
                    const color = swatch.dataset.color;
                    if (color) {
                        document.execCommand('foreColor', false, color);
                    }
                }
                notesEditor.focus();
            });

            noteColorPicker.addEventListener('input', (e) => {
                document.execCommand('foreColor', false, e.target.value);
                // Cập nhật màu nền của wrapper để người dùng thấy màu đã chọn
                e.target.parentElement.style.backgroundColor = e.target.value;
                notesEditor.focus();
            });
            
            // Auto-save notes on input
            notesEditor.addEventListener('input', () => {
                if (currentVerbId) {
                    localStorage.setItem(`verbNote_${currentVerbId}`, notesEditor.innerHTML);
                }
            });
            
            // --- Export Data ---
            exportDataBtn.addEventListener('click', () => {
                const headers = ["STT", "Kanji", "Hiragana", "Nghĩa", "Nhóm", "Thể từ điển", "Thể て", "Thể ない", "Ví dụ"];
                
                const escapeCsvCell = (cell) => {
                    if (cell === null || cell === undefined) {
                        return '';
                    }
                    const cellStr = String(cell);
                    // Nếu cell chứa dấu phẩy, dấu ngoặc kép, hoặc xuống dòng, bao nó trong dấu ngoặc kép.
                    if (cellStr.includes(',') || cellStr.includes('"') || cellStr.includes('\n')) {
                        // Thay thế mọi dấu ngoặc kép bên trong bằng hai dấu ngoặc kép.
                        return `"${cellStr.replace(/"/g, '""')}"`;
                    }
                    return cellStr;
                };

                let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // \uFEFF for BOM to support UTF-8 in Excel
                csvContent += headers.join(",") + "\r\n";

                verbData.forEach(verb => {
                    const row = [
                        verb.id,
                        verb.kanji,
                        verb.hiragana,
                        verb.meaning,
                        verb.group,
                        verb.dict,
                        verb.te,
                        verb.nai,
                        verb.example
                    ].map(escapeCsvCell).join(",");
                    csvContent += row + "\r\n";
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "N5_Verbs_Data.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });


            // Initial render
            renderTable();
        });
    </script>

</body>
</html>
